setwd("C:/VE/H3N2_glycosylation/Serology")
H3_AR <- 0.25 # mean H3 attack rate
maxY <- 12 # oldest age by which first infection with H3 must occur
H3_frac <- read.table("H3_subtype_frac.csv",header=TRUE,sep=",")
H3_int <- data.frame(year = H3_frac$year, int = H3_frac$H3/mean(H3_frac$H3))
H3_int
int_fit <- lm(H3_int$int ~ H3_int$year)
summary(int_fit)
H3_int#int[0]
H3_int$int[0]
H3_int$int[1]
H3_int$int[2]
for (y in 1:length(H3_int$year)) {
H3_int$adj[y] <- H3_int$int[y]+0.015613*(y-1)
}
H3_int$adj
f160 <- read.table("160_freq.csv",header=TRUE,sep=",")
f160_aa <- cbind(f160$T,f160$K,f160$A,f160$R,f160$Others)
colnames
colnames(f160_aa) = c('T', 'K', 'A', 'R', 'other')
160_aa
colnames(f160_aa) <- c('T','K','A','R','other')
160_aa
f160 <- read.table("160_freq.csv",header=TRUE,sep=",")
f60
f160
f160_aa <- cbind(f160$T,f160$K,f160$A,f160$R,f160$Others)
f160_aa
colnames(f160_aa) <- c('T','K','A','R','other')
T_col <- rgb(0.5,0,0.5,0.75)
K_col <- rgb(1,0,0,0.75)
A_col <- rgb(0,0.5,0,0.75)
R_col <- rgb(0.5,0.5,0.5,0.75)
oth_col <- rgb(0,0,0)
col_map <- c(T_col,K_col,A_col,R_col,oth_col)
f160_aa
type(f160_aa)
class(f160_aa)
t
t --help
t -help
t help
t(160_aa)
t(f160_aa)
class(t(f160_aa))
as.matrix(t(f160_aa))
barplot(f160_aa)
f160_aa
barplot(t(f160_aa))
barplot(f160_aa, col=col_map)
barplot(t(f160_aa), col=col_map)
barplot(f160_aa, col=col_map)
seq(1968, 1998)
seq(from=1968, to=1998)
imp160 <- data.frame(yob=seq(from=1968,to=1998))
imp160
imp160$T <- 0
imp160$K <- 0
imp160$A <- 0
imp160$R <- 0
imp160$other <- 0
imp160
thisY = 1
thisY = 1969
subset(H3_int,H3_int$year==thisY)
H3
H3_int
yob = imp160$[1]
yob = imp160$yob[1]
prob_unif = 1
this = yob + 1
thisY_int = subset(H3_int,H3_int$year==thisY)$adj
thisY_int
AR_this_year <- H3_AR*thisY_int
AR_this_year
prob_first_inf <- prob_uninf*AR_this_year
prob_first_inf <- prob_unif*AR_this_year
prob_first_inf
imp160$T[by]
imp160$T[1]
subset(f160,f160$year==thisY)$T
prob_first_inf*subset(f160,f160$year==thisY)$T
print
print(prob_unif)
for (by in 1:length(imp160$yob)) {
yob <- imp160$yob[by]
prob_uninf <- 1
for (y in 1:maxY) {
thisY <- yob + y # assuming first year of risk is year after birth
thisY_int <- subset(H3_int,H3_int$year==thisY)$adj
AR_this_year <- H3_AR*thisY_int
prob_first_inf <- prob_unif*AR_this_year
imp160$T[by] <- imp160$T[by] + prob_first_inf*subset(f160,f160$year==thisY)$T
imp160$K[by] <- imp160$K[by] + prob_first_inf*subset(f160,f160$year==thisY)$K
imp160$A[by] <- imp160$A[by] + prob_first_inf*subset(f160,f160$year==thisY)$A
imp160$R[by] <- imp160$R[by] + prob_first_inf*subset(f160,f160$year==thisY)$R
imp160$other[by] <- imp160$other[by] + prob_first_inf*subset(f160,f160$year==thisY)$Others
prob_uninf <- prob_uninf*(1-AR_this_year)
}
}
imp160_aa <- cbind(imp160$T,imp160$K, imp160$A, imp160$R, imp160$other)
imp160_aa
imp160_aa <- imp160_aa/rowSums(imp160_aa) # kluge for asymptotic infection risk
imp160_aa
colnames(imp160_aa) <- c('T','K','A','R','other')
barplot(imp160_aa)
barplot(t(imp160_aa), col=col_map)
